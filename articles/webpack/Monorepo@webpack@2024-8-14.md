# Monorepo

类别: WebPack
状态: 了解

## 单仓库管理多个项目（多模块项目）

- 幽灵依赖
    - npm安装依赖时，存在依赖提升，某个项目使用的依赖，没有在package.json，也可以直接使用。
    - 平铺结构。
    - 使用pnpm可以解决这个问题。
- 多个依赖体积过大 磁盘压力大
    - 使用pnpm按需安装以及依赖缓存，减少冗余依赖安装。
    - 增量构建，并行构建。

## Monorepo工具

- Turborepo
    - 构建任务并行构建，构建顺序交给开发者配置。
    - 通过缓存以及远程缓存，减少构建时间。
- NX
    - 是Turborepo的超集。
        - 缓存。
        - 最小返回增量构建，并非全量构建。
        - 并行构建。
        - 分布式构建。

## pnpm

- CAS内容寻址存储。
- 虚拟存储
    - 指向存储的链接的目录，所有直接和间接的依赖项都链接到项目的.pnpm目录
- 优势
    - 装包速度快：缓存中有的依赖，直接硬连接到项目的node_module中，减少copy的IO操作。
    - 磁盘利用率极高：软/硬链接方式，同一版本的依赖共用一个磁盘空间。不同版本依赖，只额外存储diff内容。
    - 解决幽灵依赖：node_module目录结构与package.json依赖列表一致。