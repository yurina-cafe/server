# 跨域与反向代理

类别: Browser
状态: 了解

## 同源策略

- **协议**、**端口号**、**域名必须一致。**
- 保证当前域下的js脚本不能访问其他域下的cookie、localstorage和indexDB。
- 保证当前域下的js脚本不能操作和访问其他域下的DOM。
- 保证当前域下无法发送跨域请求。

## 解决方案

- CORS跨资源共享
    - 在服务端进行配置添加一个响应头。
    - 客户端HTTP请求添加Access-Control-Allow-Origin：<host>。
- 服务器代理
    - 正向代理（面向客户端）
        - 客户端ABCD都通过代理服务器向服务器B发送请求。
        - 服务端B只知道代理服务器向他发送请求，不知道客户端是谁。
    - nginx（反向代理，面向服务端）
        - 客户端A通过代理服务器向服务端BC发送请求，返回资源。
        - 客户端A只知道代理服务器向他返回资源，不关心资源来自哪里。
    - 设置CORS的HTTP请求头。
    - JSONP：利用`<script>`标签没有跨域限制，通过`<script>`标签src属性，发送带有callback参数的GET请求，服务端将接口返回数据拼凑到callback函数中，返回给浏览器，浏览器解析执行，从而前端拿到callback函数返回的数据。
    - nginx代理跨域：配置请求头，通过Nginx配置一个代理服务器域名与domain1相同，端口不同）做跳板机，反向代理访问domain2接口，并且可以顺便修改cookie中domain信息，方便当前域cookie写入，实现跨域访问。